/*
CWE-ID: CVE-2022-26129
Description: Buffer overflow vulnerabilities exist in FRRouting through 8.1.0 due to wrong checks on the subtlv length in the functions, parse_hello_subtlv, parse_ihu_subtlv, and parse_update_subtlv in babeld/message.c. 
*/

#include <assert.h>
#include <stdio.h>

void parse_update_subtlv(const unsigned char *a, int alen) {
    int type, len, i = 0;

    while(i < alen) {
        type = a[i];

        if(i + 1 > alen) {
            return;
        }

        //assert(i + 1 < alen);
        len = a[i + 1]; //potential buffer overflow
        
		if(i + len + 2 > alen) {
            return;
        }
		
		i += len + 2;
	}
}

int main() {
	char a[] = {0, 0, 0, 0, 0};
	parse_update_subtlv(a, 5);
}
